<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="https://cdn.freebiesupply.com/logos/large/2x/java-logo-png-transparent.png"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
      integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <title>CRUD</title>
  </head>
  <body class="bg-dark" style="width: 100vw; height: 100vh">
    <div class="w-50 m-auto py-5">
      <div class="w-100 d-flex justify-content-between p-3">
        <h1 class="text-light">CRUD</h1>

        <!-- Button modal -->
        <button
          type="button"
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#createModal"
        >
          Create
        </button>
        <!-- end Button modal -->
      </div>

      <!-- table -->
      <table class="table table-striped table-dark w-100 m-auto">
        <thead>
          <tr>
            <th scope="col">No</th>
            <th scope="col" class="text-center w-25">Name</th>
            <th scope="col" class="text-center w-25">Age</th>
            <th scope="col" class="text-center w-25">City</th>
            <th scope="col" class="text-center w-25">Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <!-- end table -->
      <div id="kosong"></div>
    </div>

    <!-- Modal Create -->
    <div
      class="modal fade"
      id="createModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="createModalTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content bg-dark">
          <div class="modal-header">
            <h5 class="modal-title text-light" id="createModalTitle">
              Create Data
            </h5>
            <button
              type="button"
              class="close bg-dark"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true" class="text-light">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="formCreate">
              <div class="form-group">
                <label for="inputNameCreate" class="text-light pb-1"
                  >Full Name</label
                >
                <input
                  type="text"
                  class="form-control bg-dark text-light"
                  id="inputNameCreate"
                  autocomplete="off"
                  placeholder="Full Name"
                  required
                  spellcheck="false"
                />
              </div>
              <div class="form-group">
                <label for="inputAgeCreate" class="text-light pt-3 pb-1"
                  >Age</label
                >
                <input
                  type="number"
                  class="form-control bg-dark text-light"
                  id="inputAgeCreate"
                  placeholder="Age"
                  min="10"
                  max="55"
                  required
                  spellcheck="false"
                />
              </div>
              <div class="form-group">
                <label for="inputCityCreate" class="text-light pt-3 pb-1"
                  >City</label
                >
                <input
                  type="text"
                  class="form-control bg-dark text-light"
                  id="inputCityCreate"
                  autocomplete="off"
                  placeholder="City"
                  required
                  spellcheck="false"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              id="create"
              data-bs-dismiss="modal"
            >
              Create Data
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- end Modal Create -->

    <!-- Modal Update -->
    <div
      class="modal fade"
      id="updateModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="updateModalTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content bg-dark">
          <div class="modal-header">
            <h5 class="modal-title text-light" id="updateModalTitle">
              Update Data
            </h5>
            <button
              type="button"
              class="close bg-dark"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true" class="text-light">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="formUpdate">
              <div class="form-group">
                <label for="inputNameUpdate" class="text-light pb-1"
                  >Full Name</label
                >
                <input
                  type="text"
                  class="form-control bg-dark text-light"
                  id="inputNameUpdate"
                  autocomplete="off"
                  placeholder="Full Name"
                  required
                  spellcheck="false"
                />
              </div>
              <div class="form-group">
                <label for="inputAgeUpdate" class="text-light pt-3 pb-1"
                  >Age</label
                >
                <input
                  type="number"
                  class="form-control bg-dark text-light"
                  id="inputAgeUpdate"
                  placeholder="Age"
                  min="10"
                  max="55"
                  required
                  spellcheck="false"
                />
              </div>
              <div class="form-group">
                <label for="inputCityUpdate" class="text-light pt-3 pb-1"
                  >City</label
                >
                <input
                  type="text"
                  class="form-control bg-dark text-light"
                  id="inputCityUpdate"
                  autocomplete="off"
                  placeholder="City"
                  required
                  spellcheck="false"
                />
                <input type="hidden" id="id" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              id="update"
              data-bs-dismiss="modal"
            >
              Update Data
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- end Modal Update -->

    <!-- Modal Detail -->
    <div
      class="modal fade"
      id="detailModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="detailModalTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content bg-dark">
          <div class="modal-header">
            <h5 class="modal-title text-light" id="detailModalTitle">
              Detail Data
            </h5>
            <button
              type="button"
              class="close bg-dark"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true" class="text-light">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <h6 class="text-light">
              Id : <span class="text-light fw-light" id="Id"></span>
            </h6>
            <h6 class="text-light">
              Name : <span class="text-light fw-light" id="Name"></span>
            </h6>
            <h6 class="text-light">
              Age : <span class="text-light fw-light" id="Age"></span>
            </h6>
            <h6 class="text-light">
              City : <span class="text-light fw-light" id="City"></span>
            </h6>
            <h6 class="text-light">
              Created : <span class="text-light fw-light" id="Created"></span>
            </h6>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- end Modal Detail -->

    <script>
      $("document").ready(() => {
        $.get("/api/v1/student", (data) => {
          console.log(data);
          if (!data.data.length)
            $("#kosong").append(
              '<h1 class="text-light text-center">Data Kosong !!</h1>'
            );
          $("tbody").append(
            data.data.map((e, i) => {
              return `<tr>
                              <th scope="row">${i + 1}</th>
                              <td>${e.name}</td>
                              <td>${e.age}</td>
                              <td>${e.city}</td>
                              <td class="d-flex justify-content-evenly w-100">
                                <button type="button" class="btn btn-danger" onclick="handleDelete(${
                                  e.id
                                })">Delete</button>
                                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#updateModal" onclick="handleUpdate(${
                                  e.id
                                })">Update</button>
                                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#detailModal" onclick="handleDetail(${
                                  e.id
                                })">Detail</button>
                              </td>
                            </tr>`;
            })
          );
        });
      });

      $("#create").click(() => {
        const name = capLetter($("#inputNameCreate").val());
        const age = parseInt($("#inputAgeCreate").val());
        const city = $("#inputCityCreate").val();

        $("#formCreate").trigger("reset");

        $.ajax({
          url: `/api/v1/student`,
          type: "POST",
          contentType: "application/json",
          dataType: "json",
          data: JSON.stringify({ name, age, city }),
          success: function (data) {
            console.log(data);
          },
        });

        location.reload();
      });

      $("#update").click(() => {
        const name = capLetter($("#inputNameUpdate").val());
        const age = $("#inputAgeUpdate").val();
        const city = $("#inputCityUpdate").val();
        const id = $("#id").val();

        $("#formUpdate").trigger("reset");

        $.ajax({
          url: `/api/v1/student/${id}`,
          type: "PUT",
          contentType: "application/json",
          dataType: "json",
          data: JSON.stringify({ name, age, city }),
          success: function (data) {
            console.log(data);
          },
        });

        location.reload();
      });

      const handleUpdate = (id) => {
        $.get(`/api/v1/student/${id}`, (data) => {
          const [person] = data.data;
          $("#inputNameUpdate").val(person.name);
          $("#inputAgeUpdate").val(person.age);
          $("#inputCityUpdate").val(person.city);
          $("#id").val(id);
        });
      };

      const handleDelete = (id) => {
        const yakin = confirm("yakin hapus ?");
        if (yakin) {
          $.ajax({
            url: `/api/v1/student/${id}`,
            type: "DELETE",
            success: function (data) {
              console.log(data);
            },
          });
          location.reload();
        }
      };

      const handleDetail = (id) => {
        $.get(`/api/v1/student/${id}`, (data) => {
          const [person] = data.data;
          console.log(person);
          $("#Id").html(person.id);
          $("#Name").html(person.name);
          $("#Age").html(person.age);
          $("#City").html(person.city);
          $("#Created").html(person.created);
        });
      };

      const capLetter = (string) => {
        data = string.split(" ");
        string = [];

        data.map((e) => {
          string.push(e.charAt(0).toUpperCase() + e.slice(1));
        });

        return string.join(" ");
      };
    </script>
  </body>
</html>
